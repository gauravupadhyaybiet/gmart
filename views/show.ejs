<% layout("/layouts/boilerplate") %>

<div class="container my-5">

<!-- ALERTS -->
<% if(success && success.length){ %>
<div class="alert alert-success"><%= success %></div>
<% } %>

<% if(error && error.length){ %>
<div class="alert alert-danger"><%= error %></div>
<% } %>

<div class="row bg-white p-4 shadow-sm rounded">

<!-- LEFT IMAGE (Amazon style) -->
<div class="col-md-5 text-center">

<div class="amazon-image-box">
<img src="<%= showproduct.image %>" alt="<%= showproduct.name %>">
</div>

</div>

<!-- RIGHT INFO -->
<div class="col-md-7">

<h2 class="amazon-title"><%= showproduct.name %></h2>

<p class="text-muted mb-2">
by <strong><%= showproduct.owner.username %></strong>
</p>


<!-- PRICE BLOCK -->
<div class="mb-3">

<% if(showproduct.discount && showproduct.discount>0){ %>

<span class="amazon-price">
₹<%= showproduct.amount-(showproduct.amount*showproduct.discount/100) %>
</span>

<span class="amazon-old">
₹<%= showproduct.amount %>
</span>

<span class="badge bg-danger ms-2">
<%= showproduct.discount %>% OFF
</span>

<% } else { %>

<span class="amazon-price">₹<%= showproduct.amount %></span>

<% } %>

</div>

<p class="mb-3"><%= showproduct.description %></p>

<p class="text-success fw-bold">
In Stock: <%= showproduct.stock %>
</p>


<!-- ADD TO CART AMAZON BUTTON -->
<form action="/cart/add" method="POST">

<input type="hidden" name="productId" value="<%= showproduct._id %>">

<input type="number"
name="quantity"
value="1"
min="1"
class="form-control mb-3"
style="width:120px">

<button class="btn amazon-btn w-100">
Add to Cart
</button>

</form>


<!-- OWNER BUTTONS -->
<% if(curruser && showproduct.owner._id.equals(curruser._id)){ %>

<div class="mt-3">

<form method="GET"
action="/product/<%= showproduct._id %>/edit"
class="d-inline">

<button class="btn btn-outline-dark">
Edit
</button>

</form>

<form method="POST"
action="/deleteproduct/<%= showproduct._id %>?_method=DELETE"
class="d-inline">

<button class="btn btn-outline-danger">
Delete
</button>

</form>

</div>

<% } %>

</div>
</div>


<!-- REVIEWS -->

<h3 class="mt-5 mb-3">Customer Reviews</h3>

<% if(curruser){ %>

<form action="/product/<%= showproduct._id %>/reviews"
method="POST"
class="mb-4">

<select name="review[rating]" class="form-select mb-2" required>
<option value="">Select rating</option>
<option>5</option>
<option>4</option>
<option>3</option>
<option>2</option>
<option>1</option>
</select>

<textarea
name="review[comment]"
class="form-control mb-2"
placeholder="Write your review">
</textarea>

<button class="btn btn-warning">
Submit Review
</button>

</form>

<% } %>


<!-- ALL REVIEWS -->

<% for(review of showproduct.reviews){ %>

<div class="amazon-review">

<div class="fw-bold">
<%= review.author.username %>
</div>

<div class="text-warning mb-1">
<% for(let i=1;i<=review.rating;i++){ %>★<% } %>
</div>

<div><%= review.comment %></div>

<form method="POST"
action="/product/<%= showproduct._id %>/reviews/<%= review._id %>?_method=DELETE">

<button class="btn btn-sm btn-outline-danger mt-1">
Delete
</button>

</form>

</div>

<% } %>


</div>


<style>

/* AMAZON IMAGE BOX */

.amazon-image-box{
height:420px;
display:flex;
align-items:center;
justify-content:center;
background:white;
border:1px solid #eee;
padding:25px;
}

.amazon-image-box img{
max-width:100%;
max-height:100%;
object-fit:contain;
}

/* TITLE */

.amazon-title{
font-size:28px;
font-weight:500;
}

/* PRICE */

.amazon-price{
font-size:30px;
color:#B12704;
font-weight:700;
}

.amazon-old{
text-decoration:line-through;
margin-left:10px;
color:#777;
}

/* AMAZON BUTTON */

.amazon-btn{
background:#FFD814;
border:none;
font-weight:600;
}

.amazon-btn:hover{
background:#F7CA00;
}

/* REVIEWS */

.amazon-review{
border-bottom:1px solid #eee;
padding:12px 0;
}

</style>




 
